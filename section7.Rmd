---
title: "section7"
author: "Helen Simpson"
date: "10/20/2020"
output: html_document
---

```{r setup, include=FALSE}

rm(list = ls())

knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(broom)
library(lme4)
```

```{r}
my.data <- read_csv("./all_data.csv")

my.rplot <- my.data %>% ggplot(aes(x = turnout_pct, y = R_pv2p)) + geom_point() + geom_smooth(method = "lm") + theme_classic()
my.dplot <- my.data %>% ggplot(aes(x = turnout_pct, y = D_pv2p)) + geom_point() + geom_smooth(method = "lm") + theme_classic()
my.dplot

rmodel <- my.data %>% filter(!is.na(turnout_pct)) %>%
  group_by(state) %>% 
  do(tidy(lm(R_pv2p ~ turnout_pct, data = .))) %>% 
  filter(term == "turnout_pct")

dmodel <- my.data %>% filter(!is.na(turnout_pct)) %>%
  group_by(state) %>% 
  do(tidy(lm(D_pv2p ~ turnout_pct, data = .))) %>% 
  filter(term == "turnout_pct")

#r has 18 significant, d has 9 significant
rtest.data <- rmodel %>% filter(p.value < 0.1)
dtest.data <- dmodel %>% filter(p.value < 0.1)

hist(rmodel$estimate)
hist(dmodel$estimate)

state.rturnout.plot <- my.data %>%
  group_by(state) %>% 
  ggplot(aes(x = turnout_pct, y = R_pv2p)) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
    facet_wrap(. ~ state) + 
    theme_classic()
state.rturnout.plot
ggsave("docs/images/state_turnout_plot.png", plot = state.rturnout.plot, height = 15, width = 22.5)

my.data <- my.data %>% group_by(state) %>% arrange(state, year) %>% mutate(prev_turnout = dplyr::lag(turnout_pct))

# my.data$cut.turnout <- cut(my.data$turnout_pct, c(seq(from = 35, to = 80, by = 5)))
# 
# my.model <- lmer(R_pv2p ~ prev_Rvote + (1 + unem.diff|cut.turnout), data = my.data)
# summary(my.model)
```

```{r}
county.92.data.raw <- read_excel("./Turnout_Data_1992.xlsx", sheet = 3)
county.92.data <-  county.92.data.raw %>% 
  filter(!is.na(...1), ...2 != "T") %>% 
  select(...1, 
         ...2, 
         `Total Population`, 
         `Voting Age Pop`, 
         `Total Registered`, 
         Turnout, 
         Democrat...17, 
         Republican...18, 
         `Independent/Unenrolled...19`, 
         FIPS) %>% 
  rename(dem.reg = Democrat...17, 
         rep.reg = Republican...18,
         ind.reg = `Independent/Unenrolled...19`) %>% 
  mutate(year = 1992)

county.96.data.raw <- read_excel("./Turnout_Data_1996.xlsx", sheet = 3)
county.96.data <- county.96.data.raw %>% 
  filter(!is.na(...1), ...2 != "T") %>% 
  select(...1, 
         ...2, 
         `Total Population`, 
         `Voting Age Pop`, 
         `Total Registered`, 
         Turnout, 
         Democrat...17, 
         Republican...18, 
         `Independent/Unaffiliated...19`, 
         FIPS) %>% 
  rename(dem.reg = Democrat...17, 
         rep.reg = Republican...18,
         ind.reg = `Independent/Unaffiliated...19`) %>% 
  mutate(year = 1996)

county.turnout <- rbind(county.92.data, county.96.data)

county.00.data.raw <- read_excel("./Turnout_Data_2000.xlsx", sheet = 3)
county.00.data <- county.00.data.raw %>% filter(!is.na(...1), ...2 != "T") %>% 
  select(...1, 
         ...2, 
         `Total Population`, 
         `Voting Age Population`, 
         `Total Registered`, 
         Turnout, 
         Democrat...19, 
         Republican...20, 
         `Independent/Unenrolled...21`, 
         FIPS) %>% 
  rename(`Voting Age Pop` = `Voting Age Population`,
         dem.reg = Democrat...19, 
         rep.reg = Republican...20,
         ind.reg = `Independent/Unenrolled...21`) %>% 
  mutate(year = 2000)

county.turnout <- rbind(county.turnout, county.00.data)

county.04.data.raw <- read_excel("./Turnout_Data_2004.xlsx", sheet = 3)
county.04.data <- county.04.data.raw %>% filter(!is.na(...1), ...2 != "T") %>% 
  select(...1, 
         ...2, 
         `Total Population`, 
         `Voting Age Pop`, 
         `Total Registered`, 
         Turnout, 
         Democrat...18, 
         Republican...19, 
         `Independent/Unenrolled...20`, 
         FIPS) %>% 
  rename(dem.reg = Democrat...18, 
         rep.reg = Republican...19,
         ind.reg = `Independent/Unenrolled...20`) %>% 
  mutate(year = 2004)

county.turnout <- rbind(county.turnout, county.04.data)

county.08.data.raw <- read_excel("./Turnout_Data_2008.xlsx", sheet = 3)
county.08.data <- county.08.data.raw %>% filter(!is.na(...1), ...2 != "T") %>% 
  select(...1, 
         ...2, 
         `Total Population`, 
         `Voting Age Pop`, 
         `Total Registered`, 
         Turnout, 
         Democrat...19, 
         Republican...20, 
         `Independent/Unenrolled...21`, 
         FIPS) %>% 
  rename(dem.reg = Democrat...19, 
         rep.reg = Republican...20,
         ind.reg = `Independent/Unenrolled...21`) %>% 
  mutate(year = 2008)

county.turnout <- rbind(county.turnout, county.08.data)

county.12.data.raw <- read_excel("./Turnout_Data_2012.xlsx", sheet = 3)
county.12.data <- county.12.data.raw %>% 
  rename(...1 = `<- expand at left`,
         `Total Population` = Population,
         `Total Registered` = `Total Reg`,
         Turnout = `Total Vote`,
         dem.reg = Democratic...19, 
         rep.reg = Republican...20,
         ind.reg = `Independent...21`) %>% 
  filter(!is.na(...1), ...2 != "T") %>% 
  select(...1, 
         ...2, 
         `Total Population`, 
         `Voting Age Pop`, 
         `Total Registered`, 
         Turnout, 
         dem.reg, 
         rep.reg, 
         ind.reg, 
         FIPS) %>% 
  mutate(year = 2012)

county.turnout <- rbind(county.turnout, county.12.data)

county.16.data.raw <- read_excel("./Turnout_Data_2016.xlsx", sheet = 3)
county.16.data <- county.16.data.raw %>% 
  rename(`Total Population` = Population,
         `Total Registered` = `Total Reg`,
         dem.reg = Democratic...19, 
         rep.reg = Republican...20,
         ind.reg = `Independent...21`) %>% 
  filter(!is.na(...1), ...2 != "T") %>% 
  select(...1, 
         ...2, 
         `Total Population`, 
         `Voting Age Pop`, 
         `Total Registered`, 
         Turnout, 
         dem.reg, 
         rep.reg, 
         ind.reg, 
         FIPS) %>% 
  mutate(year = 2016)

county.turnout <- rbind(county.turnout, county.16.data)
```

```{r}
#merge w/ county-level vote share + demo (2000, 2004, 2008, 2012, 2016)
#run regressions, vote share on turnout
```